TODO
 - rewrite/uniqify ASTs.
   handle commutativity
   probably need hashing

 - better visitor
